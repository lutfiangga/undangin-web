---
let data = [];
try {
  const base = new URL(Astro.request.url).origin;
  const res = await fetch(`${base}/api/pricing`);

  if (!res.ok) {
    throw new Error(`Failed to fetch themes API: ${res.statusText}`);
  }
   data = await res.json();
} catch (err) {
  console.error(err);
}
---

<section
  id="pricing"
  class="flex flex-col items-center justify-center gap-2 space-y-4 py-8 sm:gap-4 md:gap-6 md:px-24 md:py-12"
>
  <div class="h-[2px] w-[20%] self-center bg-green-300"></div>
  <h1 class="text-3xl font-semibold text-white sm:text-4xl md:text-5xl">
    <span class="text-green-300">Temukan Paket</span> Terbaik Untuk Kebutuhanmu
  </h1>

  {
    data.length === 0 ? (
      <p class="text-center text-red-400">Gagal memuat data harga.</p>
    ) : (
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
        {data.map((item: any) => (
          <div
            class="rounded-xl p-6"
            style={`background-color: ${item.bgColor}; color: ${item.textColor};`}
          >
            <h3 class="text-2xl font-semibold">{item.category}</h3>
            <p class="text-sm">{item.description}</p>
            <p class="line-through">
              {Intl.NumberFormat("id-ID", {
                style: "currency",
                currency: "IDR",
              }).format(item.price)}
            </p>
            <p class="text-3xl font-bold">
              {Intl.NumberFormat("id-ID", {
                style: "currency",
                currency: "IDR",
              }).format(item.afterDiscount)}
            </p>
            <ul class="mt-4 space-y-1 list-disc list-inside">
              {item.benefit.map((b: any) => (
                <li>{b}</li>
              ))}
            </ul>
            <a
              href={`https://api.whatsapp.com/send?phone=6285740104220&text=${encodeURIComponent(
                `Halo, saya mau order paket ${item.category}`
              )}`}
              target="_blank"
              class="block mt-4 text-center border rounded py-2 hover:bg-green-300 hover:text-black"
            >
              Pilih Paket
            </a>
          </div>
        ))}
      </div>
    )
  }
</section>
